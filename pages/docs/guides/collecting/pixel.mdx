
import asset from 'next/asset'
import { withDoc } from 'app/lib'

export const meta = {
  title: 'Использование "пикселя"',
  description: 'Применяется для задач: безопасный трекинг "thankyoupage", вставки в креатив для подсчета показов, сбора данных с AMP сайтов, cookie-sync с рекламными сервисами и DMP.'
}


"Пиксель" - в данном контексте подрузумевается способ сбора данных при помощи прозрачной картинки размером 1x1 (gif 1x1 image), 
которая загружается с отслеживающего сервера. Таким образом он получает информацию о посещении/просмотре.
Может прочитать и установить куки (только со своего домена, откуда грузится пиксель).

Является самым безопасным способо отслеживания, поэтому довольно распространен в adtech сфере. 
С помощью пикселья нельзя выполнить код на странице или как-то вмешаться в ее работу: картинки грузятся последними и не тормозят загрузку, 
картинка будет трактоваться браузером как битая если придет что-то другое вместо нее.

Некоторые ошибочно называют пикселем JavaScript коды, имеющие полный доступ к странице в момент посещения.
Запомните, пиксель это картинка, а картинка переводится image, отсюда HTML тег `<img`, 
при помощи которого она встраивается. Если встраивается скрипт, то они и будет иметь тег `<script`.

Основные применения:

1. Установка на страницу "thankyoupage", для посчета конверсий. Стандартная практика для CPA и мелких рекламных сетей.
   Крупные игроки используют JavaScript код и не дают вариант использования пикселя, разве что производные Mail.ru Group.
1. Подсчет показов медийной рекламы, где он подмешивается прямо в креатив. 
1. Сбор данных с AMP (Accelerated Mobile Pages) сайтов. Технология Google позволяющая сайтам загружаться в мгновение.
   Накладывает серьезные ограничение на то, что можно использовать на странице.
1. Выполнения cookie-sync (обмен идентификаторами посетителя). 
  Используется в рекламе, чтобы находить посетителя на чужой территории.
  Например в RTB есть 3 основныпе стороны SSP, DSP и DMP. Когда в DSP приходят запросы на торги,
  передается идентификатор пользователя из SSP и надо найти соответствие своему идентификатору.
  Чтобы использовать данные DMP надо чтобы DSP знала какой у этого пользователя идентификатор у другой стороны.

## Как испозовать

Надо придумать как назвать это событие, чтобы отличить его от других, 
если проектов (сайтов/приложений) у вас несколько, укажите/придумайте им номара. 
Прописывается секциями в шаблоне. В результате подстановки получится url, 
в ответ на который вы получите пиксель, а все данные отпавятся на обработку.

Шаблон `https://{your_rockstat_domain}/{img}/{name}/{projectId}`, где

- your_rockstat_domain: домен, где у вас установлен Rockstat.
- img: название внутреннего сервиса. 
  Имена `img` или `pixel` являются преднастроенными для возврата пикселя.
- name: название события, по которому у вас получится отличить трафик с этого пикселя от других.
- projectId: id проекта, если их несколько. По желанию.

Пример:

```
https://test.rstat.org/pixel/x1_order_completed
```

Автоматически будет собрана информация о том, с какого сайта бла совершена загрузка, пусть страницы, браузер, ip
и остальная доступная информация.

Можно перердавать произвольные параметры при помощи параметров адреса

```
https://your_rockstat_domain/pixel/x1_order_completed?internal_campaign=superpuper&ad_content=wow
```


Собранные данные будут обработаны системами сохранения в ClickHouse или стриминга в другие сервисы.

Запросы можно обрабатывать программно, для этого 

### Установка в код страницы

Устанавливается между `<body></body>`, чем ближе к началу, 
тем раньше начнет грузиться и больше вероятность, что загрузится.


```html
<img src="https://your_rockstat_domain/pixel/x1_order_completed?internal_campaign=superpuper&ad_content=wow" />
```


### AMP (Accelerated Mobile Pages)

Используя специльный тег `<amp-pixel`

```html
<amp-pixel src="https://test.rstat.org/pixel/amp_pageview" layout="nodisplay"></amp-pixel>
```

Детали на [странице проекта AMP](https://www.ampproject.org/docs/reference/components/amp-pixel)


## Markdown

Использование в GitHub и других сервисах поддерживающих формат markdown 

```markdown
![https://test.rstat.org/pixel/repo_director_viewed](Моя прекрасная картиночка)
```

Результатом будет отображение не заметного глазу прозрачного пикселя.

## Пример с curl

Откройте терминал и выполните

```shell
$ curl https://test.rstat.org/pixel/test?param=myparamvalue --output -

GIF89a...
```

Curl - утилита выполнения http запросов. Также можете воспользоваться инструментами разработчика в браузере

export default withDoc({...meta})(({children}) => <>{children}</>)
